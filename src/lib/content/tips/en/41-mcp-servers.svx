
MCP gives Claude Code access to external tools, databases, and APIs through a [standardized protocol](https://modelcontextprotocol.io/). Think of it like USB-C for AI. One protocol, thousands of integrations.

I use MCP daily for database queries, GitHub PR management, and pulling live documentation. The ecosystem exploded in 2025. OpenAI, Google, and Microsoft now support MCP, and the [official registry](https://registry.modelcontextprotocol.io/) hit nearly 2,000 servers by late 2025.

## Architecture

MCP follows a client-server model. Claude Code connects to MCP servers, which expose tools and resources. The server handles actual API calls, database queries, or file operations. Claude never gets direct access to your systems.

This architecture means you can audit every action, restrict permissions per server, and swap implementations without changing prompts.

## Configuration Scopes

MCP servers can live at three levels:

| Scope | File | Use Case |
|-------|------|----------|
| **Local** | `.mcp.json` in project | Personal project tools |
| **Project** | `.mcp.json` (committed) | Team-shared via git |
| **User** | `~/.claude.json` | Cross-project utilities |

Scope precedence: Local > Project > User. When servers share names, local wins.

Use `/mcp` inside Claude Code to view status and toggle servers on/off mid-session.

## CLI Commands

```bash
# Add remote server (HTTP transport)
claude mcp add --transport http stripe https://mcp.stripe.com

# Add local server (stdio transport)
claude mcp add --transport stdio memory -- npx -y @modelcontextprotocol/server-memory

# Manage servers
claude mcp list                        # List all configured servers
claude mcp get <name>                  # Check server status and details
claude mcp remove <name>               # Remove a server

# Import and advanced
claude mcp add-json <name> '<json>'    # Add from JSON config
claude mcp add-from-claude-desktop     # Import existing Claude Desktop servers
```

Add `--scope user` for cross-project tools, `--scope project` to commit config for your team.

## Transport Types

### Streamable HTTP (Remote Servers)

The [March 2025 MCP spec](https://modelcontextprotocol.io/specification/2025-03-26/basic/transports) introduced Streamable HTTP as the standard for remote servers. Most hosted MCP servers use this.

```bash
claude mcp add --transport http notion https://mcp.notion.com/mcp
claude mcp add --transport http github https://api.githubcopilot.com/mcp/
claude mcp add --transport http api https://api.example.com/mcp \
  --header "Authorization: Bearer YOUR_TOKEN"
```

### Stdio (Local Processes)

For servers running on your machine. The most common transport for CLI tools.

```bash
claude mcp add --transport stdio memory -- npx -y @modelcontextprotocol/server-memory
claude mcp add --transport stdio custom --env API_KEY=secret -- npx my-server
```

The `--` separates Claude CLI flags from the server command. On Windows, wrap with `cmd /c npx ...` or you'll get "Connection closed" errors.

### SSE (Deprecated)

SSE transport was deprecated in the March 2025 spec. Existing SSE servers still work, but new servers should use Streamable HTTP.

## Popular MCP Servers

### Remote Services

```json
{
  "mcpServers": {
    "github": {
      "type": "http",
      "url": "https://api.githubcopilot.com/mcp/"
    },
    "notion": {
      "type": "http",
      "url": "https://mcp.notion.com/mcp"
    },
    "stripe": {
      "type": "http",
      "url": "https://mcp.stripe.com/"
    }
  }
}
```

These [remote MCP servers](https://docs.stripe.com/mcp) handle OAuth automatically. First connection opens a browser for authentication.

### Local Tools

```json
{
  "mcpServers": {
    "memory": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-memory"]
    },
    "filesystem": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-filesystem", "/path/to/allowed/dir"]
    },
    "sequential-thinking": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-sequential-thinking"]
    }
  }
}
```

**Warning about database servers**: Anthropic's reference Postgres MCP server was [archived in May 2025](https://github.com/modelcontextprotocol/servers-archived/tree/main/src/postgres) due to a SQL injection vulnerability. If you need database access, use containerized alternatives from the Docker MCP Catalog or build your own with proper input sanitization.

### Finding Servers

- [PulseMCP](https://www.pulsemcp.com/servers): 7,500+ servers, updated daily
- [MCP Registry](https://registry.modelcontextprotocol.io/): Official community-driven registry
- [awesome-mcp-servers](https://github.com/punkpeye/awesome-mcp-servers): Curated GitHub list with 78K stars

## Environment Variables

Use `${VAR}` syntax in `.mcp.json`. Supports defaults with `${VAR:-fallback}`.

```json
{
  "mcpServers": {
    "api": {
      "type": "http",
      "url": "${API_URL:-https://api.example.com}/mcp",
      "headers": {
        "Authorization": "Bearer ${API_KEY}"
      }
    }
  }
}
```

Never commit secrets. Use environment variables or inject them at runtime.

## Token Usage

MCP servers consume context tokens before you even start working. Tool definitions load at session start. I've seen setups where MCP tools ate 66,000+ tokens just loading, which is a third of the 200K context window gone.

Run `/context` to see the breakdown. The MCP tools section shows per-server consumption.

**Managing token bloat:**

- Use `/mcp` to toggle servers on/off mid-session
- Prefer servers with fewer, focused tools
- Only enable heavy servers when you actually need them

MCP outputs have limits too. Warning at 10,000 tokens, hard cap at 25,000. Override with `MAX_MCP_OUTPUT_TOKENS=50000` if needed.

## Security Considerations

MCP servers can execute code, access files, and make network requests. Treat them like npm packages from unknown authors.

[Docker's security research](https://www.docker.com/blog/mcp-security-issues-threatening-ai-infrastructure/) found 43% of analyzed servers had command injection flaws. 33% allowed unrestricted network access. 66% showed poor security practices overall.

**Real attack vectors:**

- **Prompt injection**: Malicious data from external sources manipulates Claude into unintended actions
- **Tool poisoning**: Server mutates tool definitions after installation to expand permissions
- **Data exfiltration**: Combining tools (read file + HTTP request) enables silent data leaks
- **Rug pulls**: Server update introduces malicious behavior after you've trusted it

**Protect yourself:**

1. Use [Docker MCP Toolkit](https://www.docker.com/blog/mcp-toolkit-mcp-servers-that-just-work/) to containerize servers (200+ pre-built, sandboxed, signed images)
2. Stick to official servers from known vendors (GitHub, Stripe, Notion)
3. Pin versions. Don't auto-update MCP packages.
4. Keep human-in-the-loop for anything touching sensitive data
5. Review tool definitions before enabling. Check what permissions each tool requests.

## Troubleshooting

### Common Errors

| Error | Cause | Fix |
|-------|-------|-----|
| `Connection Closed` | Transport issue or server crashed | Check server is running, restart Claude Code |
| `Request Timeout` | Operation exceeded limit | Increase timeout or break up the request |
| `Method Not Found` | Server doesn't support that tool | Check server version and docs |
| Server exits immediately | Missing args or env vars | Run `npx -y <package> --help` manually |

### Debugging Steps

1. Run `claude mcp list` to verify server is configured
2. Run `claude mcp get <name>` to check if it responds
3. Test the server command directly in terminal
4. For OAuth servers, use `/mcp` to re-authenticate

### Timeout Configuration

Slow servers can be configured with custom timeouts:

```json
{
  "mcpServers": {
    "slow-server": {
      "command": "python",
      "args": ["server.py"],
      "timeout": 120000
    }
  }
}
```

Or set startup timeout globally: `MCP_TIMEOUT=10000 claude`

## Practical Tips

Start with one server. Verify it works. Then add more. I've wasted hours debugging a broken setup only to find the issue was a conflicting server I added weeks ago.

Check `/context` after adding servers. If MCP tools are eating more than 20% of your context, you have too many enabled.

For teams, commit `.mcp.json` to git so everyone uses the same setup. But keep secrets in environment variables, not the config file.

When a server misbehaves, test it outside Claude first. Run the npx command directly. If it fails there, the issue isn't Claude Code.
