---
id: 31
title: "Custom Agents"
section: customization
summary: "Create specialized agents with their own context window, system prompt, and tool restrictions."
isFree: false
---

Custom agents are specialized AI assistants stored as Markdown files that Claude Code can delegate tasks to. Each gets its own isolated context window, dedicated system prompt, and configurable tool permissions.

## File Structure

Create agents in two locations:

- **Project-level**: `.claude/agents/` (highest priority, version-controlled)
- **User-level**: `~/.claude/agents/` (available across all projects)

```markdown
---
name: agent-name
description: When this agent should be invoked
tools: Read, Grep, Glob
model: sonnet
---

You are a [role]. Your job is to...
```

## Configuration Fields

| Field | Required | Description |
|-------|----------|-------------|
| `name` | Yes | Unique lowercase identifier with hyphens |
| `description` | Yes | When/why the agent activates (critical for auto-invocation) |
| `tools` | No | Comma-separated list. Inherits all if omitted |
| `model` | No | `haiku`, `sonnet`, `opus`, or `inherit`. Defaults to `sonnet` |
| `permissionMode` | No | `default`, `acceptEdits`, `bypassPermissions`, `plan` |
| `skills` | No | Comma-separated list of skills to auto-load |

## Model Selection

Choose models based on task complexity and cost:

| Model | Speed | Cost | Best For |
|-------|-------|------|----------|
| Haiku | Fastest (27s) | Cheapest | Simple reads, quick scans, routine tasks |
| Sonnet | Medium (86s) | Balanced | Standard development, code changes |
| Opus | Slower (76s) | 5x Sonnet | Complex reasoning, architecture decisions |

Use Haiku for lightweight agents (90% capability, 3x cost savings). Reserve Opus for critical path work only.

## Available Tools

Core tools: `Read`, `Write`, `Edit`, `Bash`, `Glob`, `Grep`, `WebFetch`, `WebSearch`, `TodoWrite`, `NotebookEdit`

Limit tool access for security. A security auditor should only have `Read, Grep, Glob`--not `Write` or `Edit`.

## Example Agents

### Security Auditor

```markdown
---
name: security-auditor
description: Reviews code for security vulnerabilities. Use after code changes or before commits.
tools: Read, Grep, Glob
model: sonnet
---

You are a security expert. Scan code for:

- SQL injection and NoSQL injection
- XSS vulnerabilities (reflected, stored, DOM-based)
- Authentication/authorization bypasses
- Sensitive data exposure (API keys, credentials)
- CSRF vulnerabilities
- Insecure deserialization
- Path traversal attacks

For each issue found:
1. Severity level (Critical/High/Medium/Low)
2. Affected file and line number
3. Explanation of the vulnerability
4. Specific fix recommendation with code example

Never suggest workarounds. Fix the root cause.
```

### Code Reviewer

```markdown
---
name: code-reviewer
description: Expert code review specialist. Use proactively after writing or modifying code.
tools: Read, Grep, Glob, Bash
model: inherit
---

You are a senior code reviewer ensuring high standards.

When invoked:
1. Run git diff to see recent changes
2. Focus on modified files
3. Begin review immediately

Review for:
- Clean code principles (SOLID, DRY, KISS)
- Proper error handling
- Edge cases and null checks
- No exposed secrets
- Good test coverage
- Performance considerations

Provide feedback by priority:
- Critical (must fix before merge)
- Warnings (should fix)
- Suggestions (nice to have)

Include specific code examples for fixes.
```

### Test Runner

```markdown
---
name: test-runner
description: Use proactively to run tests and fix failures after code changes.
tools: Read, Edit, Bash, Grep, Glob
---

You are a test automation expert.

When invoked:
1. Run the appropriate test command (npm test, pytest, etc.)
2. If tests pass, report success
3. If tests fail:
   - Analyze failure messages
   - Identify root cause
   - Fix the issue (not the test, unless the test is wrong)
   - Re-run to verify

Never modify tests to make them pass. Fix the underlying code.
```

### Debugger

```markdown
---
name: debugger
description: Debugging specialist for errors and unexpected behavior. Use when encountering issues.
tools: Read, Edit, Bash, Grep, Glob
model: opus
---

You are an expert debugger specializing in root cause analysis.

When invoked:
1. Capture error message and stack trace
2. Identify reproduction steps
3. Form hypotheses
4. Add strategic debug logging if needed
5. Implement minimal fix
6. Verify solution

For each issue provide:
- Root cause explanation
- Evidence supporting diagnosis
- Specific code fix
- Prevention recommendations

Focus on the underlying issue, not symptoms.
```

## Invocation Methods

### Explicit Invocation (Recommended for Production)

```
Use the security-auditor to check the auth module
Have the code-reviewer look at my recent changes
```

### Automatic Delegation

Claude matches task descriptions to agent `description` fields. Make descriptions action-oriented:

- Bad: "Helps with code"
- Good: "Reviews Python code for security vulnerabilities, PEP 8 compliance, and performance issues"

Include "use PROACTIVELY" or "MUST BE USED" in descriptions to encourage automatic invocation.

## Context Isolation Benefits

Each agent gets its own context window:

1. **Prevents context pollution** - Main conversation stays focused on high-level goals
2. **Enables larger tasks** - Agents can explore dozens of files without cluttering main context
3. **Security isolation** - Different tool permissions per agent
4. **Parallel execution** - Spin up multiple agents simultaneously

The main agent only receives a summary of the subagent's findings, not its full context.

## Team Sharing

Check `.claude/agents/` into version control:

```bash
git add .claude/agents/
git commit -m "Add team code review and security agents"
```

Benefits:
- Team shares battle-tested agents
- Consistent workflows across developers
- Agents evolve with the codebase

## Cost Control

Use `--max-turns` to limit agent actions:

```bash
claude -p "Fix linting errors" --max-turns 3
```

This prevents runaway processes and unpredictable costs in CI/CD pipelines.

## Debugging Tips

- Use `claude --debug` to see agent loading errors
- Check YAML syntax: tools must be comma-separated (not one per line)
- Verify frontmatter starts with `---` on line 1 (no blank lines before)
- Use spaces for indentation (not tabs)

## Best Practices

1. **Single responsibility** - One clear job per agent
2. **Limit tools** - Only grant what's necessary
3. **Detailed prompts** - Include specific instructions, examples, constraints
4. **Start with Claude** - Use `/agents` command to generate initial agent, then customize
5. **Version control** - Check project agents into git
6. **Explicit invocation** - Name agents directly for predictable behavior
