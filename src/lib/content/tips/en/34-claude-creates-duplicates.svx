---
id: 34
title: "Claude Creates Duplicates"
section: pitfalls
summary: "Claude doesn't search your codebase. It just writes new code."
isFree: false
---

Claude doesn't search your codebase before writing code. It just writes. Ask for a date formatter and you'll get a new one, even if you already have three. Request a modal component and Claude builds from scratch rather than finding the one that's been working for months.

This isn't laziness. It's how the model operates.

## Why Claude Creates Duplicates

Claude Code can search your codebase with grep, glob, and file reads. But it won't search automatically. Without explicit instructions, it generates code that "looks right" based on training patterns rather than checking what already exists.

Several factors drive this:

**Context window limits.** Claude only "sees" a small portion of your codebase at any time. When you ask for a feature, it might only have access to currently open files. Your existing utilities aren't in context, so they don't exist from Claude's perspective.

**Conservative bias.** When uncertain whether a file exists or where it lives, Claude defaults to creating new code rather than risking overwrites. Better to duplicate than destroy something important.

**Prediction over analysis.** Claude predicts likely code patterns. It's not reasoning "this logic already exists in utils/dates.ts." It's thinking "a date formatting function typically looks like this." Duplication isn't a bug, it's a side effect of how prediction works.

## The Numbers Are Bad

[GitClear analyzed 211 million changed lines of code](https://www.gitclear.com/ai_assistant_code_quality_2025_research) from 2020-2024. The trends since AI coding tools went mainstream:

- **4x increase in code cloning**
- **Copy/pasted lines rose from 8.3% to 12.3%** between 2021-2024
- **Refactoring dropped from 25% to under 10%** of changed code
- **2024 was the first year copy/pasted lines exceeded moved lines**

That last point matters. "Moved" code indicates refactoring and consolidation. "Copy/pasted" means duplication. For the first time in GitClear's history, developers are duplicating more than they're refactoring.

The number of code blocks with 5+ duplicated lines increased 8x during 2024 alone.

API evangelist Kin Lane put it bluntly in a [LeadDev article](https://leaddev.com/software-quality/how-ai-generated-code-accelerates-technical-debt): "I don't think I have ever seen so much technical debt being created in such a short period of time during my 35-year career in technology."

## What Duplication Actually Looks Like

I've seen these in codebases after heavy Claude usage:

- `user_auth.py` vs `authentication.py` vs `auth_handler.py` doing the same thing
- Three date formatting utilities in different modules
- Two modal components with slightly different prop names
- Multiple API client wrappers, each with its own error handling approach
- Helper functions for string manipulation scattered across files

The worst part isn't finding duplicates. It's not knowing which version is "correct" six months later.

## Duplicates Compound Problems

[CodeRabbit analyzed 470 GitHub pull requests](https://www.coderabbit.ai/blog/state-of-ai-vs-human-code-generation-report), comparing AI-coauthored PRs to human-only ones. AI-generated code showed:

- **Nearly 2x more naming inconsistencies** (mismatched terminology, generic identifiers)
- **2.66x more formatting problems** despite linters and formatters
- **1.7x more issues overall** per pull request

Functions end up following different naming conventions, error-handling strategies, and architectural patterns depending on when Claude generated them. Your codebase becomes a patchwork.

Research from the [ACM Transactions on Software Engineering and Methodology](https://dl.acm.org/doi/10.1145/3607181) found that 57.1% of co-changed code clones were involved in bugs. When you have duplicate code, fixing a bug in one copy doesn't fix it in the others. The vulnerability persists.

## The Fix: Tell Claude to Search First

Add explicit search-first instructions to your CLAUDE.md:

```markdown
## Before Writing New Code

Before creating ANY new utility, component, or helper:

1. Search the codebase for existing implementations (grep/glob)
2. Check for files with related names or functionality
3. If something similar exists, use it or extend it
4. Never create what already exists

If you find existing code:
- Use it exactly, or copy and adapt
- Follow its naming conventions
- Match its style and error handling
```

## Vague Instructions Don't Work

"Follow existing patterns" sounds reasonable. In practice, it gives Claude too much latitude to interpret what that means. It'll create something pattern-adjacent that still fragments your codebase.

Be explicit:

**Weak**: "Follow existing patterns"
**Strong**: "Copy the structure from `/src/components/Modal.tsx` exactly. Same props, same styling approach, same animation. Only change the content."

**Weak**: "Use our date formatting"
**Strong**: "Use `formatDate()` from `/src/utils/dates.ts`. Do not create a new date formatting function."

**Weak**: "Match our code style"
**Strong**: "Check `/src/components/` for similar components. Copy the structure, imports, and patterns. No variations."

Point at specific files. Name the functions. Leave no room for interpretation.

## Document What Already Exists

List your utilities and components explicitly in CLAUDE.md:

```markdown
## Existing Utilities - NEVER Recreate

- Date formatting: `src/utils/dates.ts` (formatDate, parseDate, getRelativeTime)
- API client: `src/lib/api/client.ts` (get, post, put, delete methods)
- Form validation: `src/utils/validation.ts` (validateEmail, validatePhone)
- Modal: `src/components/Modal.tsx`
- Button: `src/components/Button.tsx`
```

This puts existing code directly in context. Claude sees the list before writing anything new.

## Make Claude Report Before Building

When requesting features, force a search first:

```
Before writing any code, search the codebase for:
- Existing date formatting utilities
- Similar modal implementations
- API client patterns we're using

Report what you find. Don't write code until I confirm.
```

This catches duplicates before they happen. You'll often discover Claude found exactly what you needed.

## Automated Detection Helps

Catch duplicates that slip through with static analysis:

**[jscpd](https://github.com/kucherenko/jscpd)** is a standalone copy-paste detector supporting 150+ languages. Easy to run locally or in CI:

```bash
jscpd --min-lines 5 --min-tokens 50 ./src --reporters json
```

**[SonarQube](https://www.sonarsource.com/products/sonarqube/)** detects duplication as part of broader code quality analysis. Better for teams already tracking technical debt.

**[PMD CPD](https://docs.pmd-code.org/)** (Copy-Paste Detector) works well in Java-heavy workflows. Integrates with Maven and Ant.

**[CodeAnt AI](https://www.codeant.ai/duplicate-code-detection)** uses semantic analysis to find duplicates even when variable names differ. Catches logic duplication, not just text matches.

Add one of these to your CI pipeline. Flag duplicates before they merge.

## The DRY Principle Gets Harder

The DRY principle ("Don't Repeat Yourself") says every piece of knowledge should have a single, unambiguous representation in your system.

AI-generated code works against this by default. Claude optimizes for completing your immediate request, not for long-term codebase health.

A few adjustments help:

**Refactor more often.** AI-assisted development creates duplication faster than traditional coding. Schedule regular consolidation passes. Look for utilities that should be shared.

**Don't over-abstract prematurely.** Two similar-looking functions might represent different business rules. Verify they actually duplicate logic before merging them.

**Catch it early.** A duplicate created today is easier to remove than one that's been in production for six months with code depending on it.

## The Real Solution

Claude doesn't inherently understand your codebase. It generates plausible code based on patterns. Every time you skip explicit instructions, you're gambling that it won't create duplicates.

Put search-first instructions in CLAUDE.md. List your existing utilities. Point at specific files in your prompts. Run duplication detection in CI.

None of this is hard. But it's not automatic. You have to make it happen.
